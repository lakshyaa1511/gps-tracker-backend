{% extends "base.html" %}
{% block title %}Devices{% endblock %}
{% block content %}
<div class="container mt-4">
  <!-- Header with Search -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary animate__animated animate__fadeInLeft">Your Devices</h2>
    <div class="d-flex">
      <input id="searchBar" type="text" class="form-control me-2 shadow-sm"
             placeholder="üîç Search devices...">
      <a href="{{ url_for('dashboard') }}" class="btn btn-success rounded-3 animate__animated animate__fadeInRight">
        + Add Device
      </a>
    </div>
  </div>

  {% if devices %}
    <div class="table-responsive animate__animated animate__fadeInUp">
      <table class="table table-hover shadow-sm rounded-3 overflow-hidden align-middle" id="devicesTable">
        <thead class="table-dark">
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Device ID</th>
            <th scope="col">Status</th>   <!-- üîπ Added -->
            <th scope="col" class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for device in devices %}
          <tr class="animate__animated animate__fadeInUp">
            <td class="fw-bold text-dark">{{ device.name }}</td>
            <td class="text-muted">{{ device.id }}</td>

            <!-- üîπ New Status Column -->
            <td>
              {% if device.is_online %}
                <span class="badge bg-success">‚óè Online</span>
              {% else %}
                <span class="badge bg-danger">‚óè Offline</span>
              {% endif %}
            </td>

            <td class="text-center">
              <a href="{{ url_for('map_device', device_id=device.id) }}" 
                class="btn btn-sm btn-outline-success">Map</a>
              <a href="{{ url_for('view_history', device_id=device.id) }}" 
                class="btn btn-sm btn-outline-info">History</a>
              <a href="{{ url_for('edit_device', device_id=device.id) }}" 
                class="btn btn-sm btn-outline-warning rounded-3 px-3 me-1">
                <i class="bi bi-pencil-square"></i> Edit
              </a>
              <form action="{{ url_for('delete_device', device_id=device.id) }}" 
                    method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-outline-danger rounded-3 px-3"
                        onclick="return confirm('Are you sure you want to delete this device?');">
                  <i class="bi bi-trash-fill"></i> Delete
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
    </div>
  {% else %}
    <div class="alert alert-info text-center shadow-sm animate__animated animate__fadeIn">
      <i class="bi bi-info-circle-fill"></i> No devices found.  
      Add one from your <a href="{{ url_for('dashboard') }}" class="fw-bold text-primary">Dashboard</a>.
    </div>
  {% endif %}
</div>

<!-- JS for Search -->
<script>
  document.getElementById("searchBar").addEventListener("input", function () {
    let query = this.value.toLowerCase();
    document.querySelectorAll("#devicesTable tbody tr").forEach(row => {
      row.style.display = row.dataset.name.includes(query) ? "" : "none";
    });
  });
</script>
{% endblock %}
